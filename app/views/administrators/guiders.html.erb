<h1>Manage guiders</h1>
<p class="lead">Find and select guiders and then select the action you wish to perform.</p>

<table class="table table-hover" id="guiders">
  <thead>
    <tr>
      <th width="5%">
        #<br>
        <input type="checkbox" class="guider__select-all" id="selectall">
      </th>
      <th width="20%">
        Name<br>
        <small><a href="#" class="sort" data-sort="name">Sort by name</a></small>
      </th>
      <th width="25%">
        Groups<br>
        <small><a href="#" class="sort" data-sort="groups">Sort by groups</a></small>
      </th>
      <th width="50%">
        Bookable times<br>
        <small><a href="#" class="sort" data-sort="slots">Sort by times</a></small>
      </th>
    </tr>
  </thead>

  <tr class="well">
    <td colspan="4">
      <div class="row">
        <div class="col-lg-12">
          <div class="input-group">
            <input type="text" class="form-control search" placeholder="Search by anything to find a guider">
            <span class="input-group-btn">
              <button class="btn btn-default" type="submit">
                <span class="glyphicon glyphicon-plus"></span>
              </button>
            </span>
          </div>
        </div>
      </div>
    </td>
  </tr>

  <tbody class="list">
    <% 45.times do %>
      <tr class="guider">
        <td>
          <input type="checkbox" class="guider__checkbox">
        </td>
        <td class="name">
          <%= ['Harry', 'Mary', 'Ben', 'Jo', 'Quentin', 'Jacqui', 'Matt', 'Lucinda'].sample %>
          <%= ['Wilson', 'Beith', 'Barnett', 'Lovell', 'Lucht', 'Guntrip', 'Singh', 'Craig'].sample %>
        </td>
        <td class="groups">
          <%
          groups = ['Southern Rail', 'Trainee', '', '', '', '', '', '', ''].sample(2)
          groups.each do |group|
          %>
            <span class="label label-info"><%= group %></span>
          <%
          end
          %>
        </td>
        <td class="slots">
          <%
          slot_group = slots_by_group([0, 1, 2].sample)
          puts slot_group
          slots = slot_group[['Group 1', 'Group 2', 'Group 3'].sample.to_sym]
          %>

          <% slots.each do |slot| %>
            <span class="label label-primary"><%= slot %></span>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="guider__action-panel">
  With the <span class="guider__number-selected">0</span> guiders selected

  <select name="action" class="js-action-list">
    <option value="<%= url_for(administrators_groups_path) %>">Add/remove to groups</option>
    <option value="<%= url_for(administrators_guider_slots_path) %>">Manage bookable times</option>
    <option>Transfer appointments to another guider</option>
    <option>Remove from system</option>
  </select>

  <a class="btn btn-primary js-go-link" href="<%= url_for(administrators_groups_path) %>">Go</a>
</div>

<% content_for :body_end do %>
  <%= javascript_include_tag "list.js/dist/list" %>
  <script>
    $('.js-action-list').on('change', function() {
      $('.js-go-link').attr('href', $(this).val());
    });

    $('.guider').on('click', function(e) {
      if ($(e.target).is('.guider__checkbox')) {
        return;
      }

      $(this).find('.guider__checkbox').click();
    });

    $('.guider__checkbox').change(function() {
      var func = $(this).is(':checked') ? 'addClass' : 'removeClass';
      $(this).parents('.guider')[func]('guider--selected');

      $('.guider__number-selected').text($('.guider__checkbox:checked').length);
    });

    $('.guider__select-all').on('change', function() {
      if ($(this).is(':checked')) {
        $('.guider__checkbox').attr('checked', 'checked').change();
      }
      else {
        $('.guider__checkbox').removeAttr('checked').change();
      }
    });

    $('.sort').on('click', function(e) {
      e.preventDefault();
    });

    var options = {
      valueNames: ['name', 'groups', 'slots']
    };

    var guiderList = new List('guiders', options);
  </script>
<% end %>
